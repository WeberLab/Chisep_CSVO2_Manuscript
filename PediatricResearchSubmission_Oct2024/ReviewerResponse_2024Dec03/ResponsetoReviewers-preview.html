<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.7.13">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Response to Reviewers</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../../index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-66ab7fd5e73b7f0a764e0d49b3e29ab1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2c88cddbe429b4d834f83549c26762d7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      </head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Response to Reviewers</h6>

            <a href="../../PediatricResearchSubmission_Oct2024/ReviewerResponse_2024Dec03/ResponsetoReviewers.md" class="btn btn-primary quarto-download-embed" download="ResponsetoReviewers.md">Download Notebook</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Response to Reviewers</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    <div class="quarto-code-links"><div class="quarto-title-meta-heading">Code Links</div><div class="quarto-title-meta-contents"><span style="padding-right: 0.5em;"><a href="https://github.com/WeberLab/Chisep_CSVO2_Manuscript/" target="_blank"><i class="bi bi-github"></i>GitHub Repo</a>,</span><span><a href="https://mybinder.org/v2/gh/WeberLab/Chisep_CSVO2_Manuscript/HEAD?urlpath=rstudio" target="_blank"><i class="bi bi-journals"></i>Launch Binder</a></span></div></div></div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#editor-comments-to-author" id="toc-editor-comments-to-author" class="nav-link active" data-scroll-target="#editor-comments-to-author">Editor Comments to Author</a>
  <ul class="collapse">
  <li><a href="#section-editor-1" id="toc-section-editor-1" class="nav-link" data-scroll-target="#section-editor-1">Section Editor: 1</a></li>
  </ul></li>
  <li><a href="#reviewers-comments-to-author" id="toc-reviewers-comments-to-author" class="nav-link" data-scroll-target="#reviewers-comments-to-author">Reviewer(s)’ Comments to Author</a>
  <ul class="collapse">
  <li><a href="#reviewer-1" id="toc-reviewer-1" class="nav-link" data-scroll-target="#reviewer-1">Reviewer: 1</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <p>Reviewer’s original suggestions are in quote blocks and in <strong>bold</strong><br>
Our response follows in normal font, and changes to the document are in quote blocks and normal font.</p>
<section id="editor-comments-to-author" class="level1">
<h1>Editor Comments to Author</h1>
<section id="section-editor-1" class="level2">
<h2 class="anchored" data-anchor-id="section-editor-1">Section Editor: 1</h2>
<blockquote class="blockquote">
<p><strong>Comments to the Author:</strong><br>
<strong>This manuscript by Weber et al.&nbsp;is focused on oxygenation quantification in the SSS and CCV in 19 premature infants utilizing susceptibility mapping and paramagnetic separation, which is compared directly and thoroughly with the preceding literature using a variety of techniques. This is significant in that it may provide an additional, and hopefully more accurate, way to measure oxygenation in premature infants. Overall this is an impressive and well planned study.</strong></p>
</blockquote>
<p>Thank you for your kind words and for taking the time to review our manuscript.</p>
<hr>
<blockquote class="blockquote">
<p><strong>The main issue which needs to be addressed revolves around the conclusions, and that the presented data do not support that this has superior accuracy. It is important because some of the findings contradict previous studies. The language here needs to be softened</strong></p>
</blockquote>
<p>We agree. It is important that our conclusions do not overstate the evidence provided. Based on the editor’s recommendation, we have now softened our language in the abstract, impact statement, and conclusion:</p>
<p>Abstract:</p>
<blockquote class="blockquote">
<p>While paramagnetic component decomposition yielded SSS values closer to those found in the literature, it increased variability. No significant oxygenation differences were found between the SSS and CCV, contrasting with prior studies.</p>
</blockquote>
<p>Impact Statement:</p>
<blockquote class="blockquote">
<p>This study evaluated the use of QSM and its paramagnetic components to measure cerebral oxygenation in neonates.</p>
</blockquote>
<p>Conclusion:</p>
<blockquote class="blockquote">
<p>This study aimed to evaluate how the use of susceptibility separation on preterm neonatal QSM images could be used in determining the oxygenation of cerebral venous vessels</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>In the methods, there are 3 lines where “***” appears, I am not sure what that is supposed to represent (lines 102, 104, 117).</strong></p>
</blockquote>
<p>These asterisks’ were included in order to abide by what we believed <em>Pediatric Research’s</em> submission guidelines were, to anonymize the paper from reviewers. These will be replaced with the identifying information once accepted. Or, if we made a mistake, we are happy to de-anonymize them for the reviewers.</p>
<hr>
<blockquote class="blockquote">
<p><strong>Requires additional clarification related to imaging analysis and how it leads to their conclusion</strong></p>
</blockquote>
<p>We agree with the editor and with the reviewers below who made similar comments. Please see our responses below for a detailed summary of the changes we made.</p>
</section>
</section>
<section id="reviewers-comments-to-author" class="level1">
<h1>Reviewer(s)’ Comments to Author</h1>
<section id="reviewer-1" class="level2">
<h2 class="anchored" data-anchor-id="reviewer-1">Reviewer: 1</h2>
<blockquote class="blockquote">
<p><strong>Comments to the Author</strong><br>
<strong>Summary:</strong><br>
<strong>This study aims to quantify oxygenation in the superior sagittal sinus and in central cerebral veins in a cohort of 19 preterm neonates using quantitative susceptibility mapping and the separation of its paramagnetic components.</strong><br>
<strong>The authors observed no significant differences between the oxygenation of the SSS and CCV, which contradicts previous results reported in the literature. They reported that the accuracy of the paramagnetic source separation was higher than QSM, but at the cost of an increased variability.</strong><br>
<strong>The methods of the manuscript are well detailed, and the results are appropriately compared to the literature. A few aspects require some clarification, see below.</strong></p>
</blockquote>
<p>We thank the reviewer for taking the time to read our manuscript and for making suggestions to help improve the final result.</p>
<hr>
<blockquote class="blockquote">
<p><strong>One limitation of this work is the lack of sufficient data to support the claim of increased accuracy with susceptibility sources separation compared to QSM. In the absence of a ground truth and with results that contradict literature, this work does not support the increased accuracy claimed. The conclusion of the work should be re-written to better reflect the actual results.</strong></p>
</blockquote>
<p>We agree with the reviewer. Without a ground truth to compare to, it is difficult to say if our results reflect a more accurate measure. We have now included wording saying as much, and rewritten the conclusion as follows:</p>
<blockquote class="blockquote">
<p>This study aimed to evaluate how the use of susceptibility separation on preterm neonatal QSM images could be used in determining the oxygenation of cerebral venous vessels</p>
</blockquote>
<p>The impact statement was also changed:</p>
<blockquote class="blockquote">
<p>This study evaluated the use of QSM and its paramagnetic components to measure cerebral oxygenation in neonates.</p>
</blockquote>
<p>Along with the abstract:</p>
<blockquote class="blockquote">
<p>While paramagnetic component decomposition yielded SSS values closer to those found in the literature, it increased variability. No significant oxygenation differences were found between the SSS and CCV, contrasting with prior studies.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>Specific Issues:</strong><br>
<strong>Abstract:</strong><br>
<strong>1. Please re-write the first sentence of the conclusion section of the abstract to better reflect the results presented in this work, which do not fully support the current claim of increased accuracy with susceptibility source separation.</strong></p>
</blockquote>
<p>The first sentence of the conclusion of the abstract has been changed to better reflect our findings:</p>
<blockquote class="blockquote">
<p>While paramagnetic component decomposition yielded SSS values closer to those found in the literature, it increased variability. No significant oxygenation differences were found between the SSS and CCV, contrasting with prior studies.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>Introduction:</strong><br>
<strong>2. It is mentioned that methods to assess whole brain oxygenation have been developed for adults and that they are starting to be explored in neonates. Please detail what are the challenges for transferring these methods to neonate population.</strong></p>
</blockquote>
<p>We have adjusted this section to now read:</p>
<blockquote class="blockquote">
<p>For the preceding reasons, non-invasive MRI-based techniques are actively being explored to assess regional and whole-brain blood oxygenation. While MRI-based methods have been developed for adults (9-11), their application in neonates is only beginning to be explored (12-16). This delay is likely due to the unique challenges posed by neonates, including their smaller anatomies, distinct hemodynamic profiles, susceptibility to motion artifacts, and the difficulties associated with recruiting this population for research.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>Method:</strong><br>
<strong>Image acquisition</strong><br>
<strong>3. Please state in the text the plane of acquisition for each sequence.</strong></p>
</blockquote>
<p>We now include the plane of acquisition for each sequence in the text of the Image Acquisition section.</p>
<hr>
<blockquote class="blockquote">
<p><strong>4. Table 1: The phase encoding row (2nd row) does not provide the phase encoding information. This row should be split in two, one for the acquisition plane information (axial, coronal, sagittal), and one for the actual phase encoding direction in plane (ex: right-left, antero-posterior, or head-foot).</strong></p>
</blockquote>
<p>We thank the reviewer for catching this. We have now updated the table to reflect these changes by adding a row for Acquisition plane, and fixing the Phase-encoding direction</p>
<hr>
<blockquote class="blockquote">
<p><strong>Image analysis:</strong><br>
<strong>5. Briefly explain why the fifth echo was selected to generate the preliminary brain mask.</strong></p>
</blockquote>
<p>The last (fifth) echo was used to create the brain mask as the last echo will have the greatest signal decay from air-bone-tissue interfaces. This is important to use in order to properly avoid introducing aliasing in the inverse problem. We now include an explanation of this in our methods for readers:</p>
<blockquote class="blockquote">
<p>The last echo is used to generate the brain mask as it reliably removes artifacts from air-tissue and bone-tissue interfaces, e.g., sinuses, without the need for manual erosion. The reason for this is at longer echo times, tissues with rapid signal decay (such as bone, air, and sinuses) lose their MRI signal due to dephasing caused by greater magnetic field inhomogeneities.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>6. Please clarify if all echoes were used for the preliminary QSM calculation.</strong></p>
</blockquote>
<p>We apologise for the confusing way our methods section was written. The methods now describe that the fifth echo was used for mask creation; the STI suite used all five echoes to create five separate QSM images; the 3rd, 4th and 5th QSM maps were then averaged to create the final QSM image for which chi values are taken. The <span class="math inline">\(\chi\)</span>-separation toolbox outputs a single map for diamagnetic, paramagnetic, and QSM. Please see the tracked changes in the methods section, and our response to #8 below.</p>
<hr>
<blockquote class="blockquote">
<p><strong>7. Can the authors expand on the motivation for choosing the STI software? What does ‘cleanest images’ refer to exactly (accuracy, artifact free, etc.)? Please also add a reference to support this statement.</strong></p>
</blockquote>
<p>The STI software appeared to give the best images, based on a visual check by the authors. As this was based on our opinion, we cannot provide a reference for this.<br>
We now include an explanation of this in the methods:</p>
<blockquote class="blockquote">
<p>STI Suite (v. 3.0), was used to process the final QSM images as it produced the images with the least amount of artifacts (based on a visual assessment by the authors) without eroding the SSS.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>8. Can the authors explain why only the last three echoes were used for the STI QSM calculation?</strong></p>
</blockquote>
<p>This was an error in reporting we have now fixed. Please see the response below.</p>
<hr>
<blockquote class="blockquote">
<p><strong>9. The methods description mentions that the last three echoes only were used for the STI calculation, but then in the parameters listed in the text, it is mentioned that a TE1=5 ms was used, which is the first TE of the sequence. Can the authors clarify this?</strong></p>
</blockquote>
<p>We apologise for this. The way it was written was not clear. We used all five echoes to produce a five echo QSM image, but then averaged the last three echoes to produce the final QSM image. The section now reads:</p>
<blockquote class="blockquote">
<p>The finalized brain mask along with the magnitude and phase images were used in STI Suite along with the following parameters: 0.9766 x 0.9766 x 1 mm3 voxel size, 5 ms TE1, 5.24 ms TE, and 77.4 ms sum TE, B0 strength = 3, and B0 direction = [0, 0, 1]. The 3D GRE data option was selected for the phase processing stage, and STAR-QSM was selected for the QSM stage. The last three echoes of the QSM were then averaged to create the final QSM image using fslmaths, as the accumulation of phase due to susceptibility is small in early echoes and artifacts dominate the phase.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>10. In the paragraph describing the methods for the paramagnetic source separation, please list the TEs in ms unit instead of s for consistency with the rest of the manuscript. Also in the same paragraph, please use the acronym introduce earlier in the text for delta TE for consistency.</strong></p>
</blockquote>
<p>We thank the reviewer for catching these. We originally stated the TEs in seconds in this section as that is what the paramagnetic source software uses when entering units. However, we believe that using consistent units throughout the manuscript would be best. We have made this correction in this section.</p>
<hr>
<blockquote class="blockquote">
<p><strong>11. Can the authors include an illustration of the final SSS and CCV masks used to calculate mean susceptibility in these regions?</strong></p>
</blockquote>
<p>Yes of course. We agree that this would be a good addition to the paper.</p>
<p>Please see the new figure now numbered Figure 2.</p>
<hr>
<blockquote class="blockquote">
<p><strong>Results:</strong><br>
<strong>12. Figure 2: Please add a label to the colorbars (ex: chi (ppm)). Also, please clarify in the caption what the x/y/z label on each figure refers to.</strong></p>
</blockquote>
<p>“<span class="math inline">\(\chi\)</span> (ppm)” has now been added to the two colorbars. In addition, we now include the following in the caption:</p>
<blockquote class="blockquote">
<p>The color bars in (b) and (c) indicates the range of susceptibility <span class="math inline">\(\chi\)</span> values in parts per million.</p>
</blockquote>
<p>The caption also now includes a sentence at the end that reads:</p>
<blockquote class="blockquote">
<p>y, x and z values represent the slice number in each plane (coronal, sagittal, and axial, respectively).</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>13. Figure 3: In the text referring to fig 3, the graphs presented are referred to as boxplots, versus in the figure caption, they are referred to as violin plots. Please make sure to consistently use the same term.</strong></p>
</blockquote>
<p>We apologise for missing this. The text has been changed to reflect the appropriate plot name: ‘violin plots’.</p>
<blockquote class="blockquote">
<p>Violin plots of the comparisons are shown in Figure 3.</p>
</blockquote>
<hr>
<blockquote class="blockquote">
<p><strong>Discussion</strong><br>
<strong>14. The authors mention being the first to explore the susceptibility source separation technique in neonates, while it has been done in adult population. Please discuss the challenges of transferring this technique to a neonate population and how these were address in this work.</strong></p>
</blockquote>
<p>Often times new techniques will first be used in adults before eventually being used in neonatal populations. Part of this is due to the relative difficulty in acquiring ethics and recruiting subjects for neonatal research. My lab has a focus on neonatal brain development and I happen to be interested in QSM. We believe we are the first to perform this type of analysis in a neonatal population simply due to a combination of luck, access to data, and timing. However, please see our response to #2 above where we now include some of the challenges in scanning neonates in the introduction.</p>
<hr>
<blockquote class="blockquote">
<p><strong>15. Can the authors discuss why, based on their results, QSM underestimates the susceptibility compared to the paramagnetic component separation technique?</strong></p>
</blockquote>
<p>Reading over the manuscript, we realise this is a very important concept that should have been included in the introduction. We now include the following sentence near the end of the introduction:</p>
<blockquote class="blockquote">
<p>Furthermore, QSM tends to underestimates parametric components due to the inclusion of diamagnetic tissue, and vice versa, as the opposing magnetic susceptibilities effectively subtract from one another.</p>
</blockquote>
</section>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  
</body></html>